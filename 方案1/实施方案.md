# 研发平台实施方案

## 目录

1. [项目概述](#1-项目概述)
2. [系统架构设计](#2-系统架构设计)
3. [技术选型与开源组件](#3-技术选型与开源组件)
4. [模块设计方案](#4-模块设计方案)
5. [数据架构](#5-数据架构)
6. [集成方案](#6-集成方案)
7. [实施计划](#7-实施计划)
8. [风险与应对](#8-风险与应对)
9. [资源估算](#9-资源估算)

---

## 1. 项目概述

### 1.1 项目背景

本研发平台面向微波系统研发部门，涵盖产品管理、产品开发、技术开发三个实体团队及综合管理虚拟团队。平台需要支持：

- **单机/模块/软件/技术开发**全生命周期管理
- **IPD集成产品开发流程**数字化落地
- **产品货架与技术货架**重用策略
- **知识资产沉淀与复用**
- **团队协作与即时通信**

### 1.2 建设目标

| 目标维度 | 具体目标 |
|---------|---------|
| 流程规范化 | 实现IPD流程数字化，确保开发过程可追溯、可管控 |
| 资产复用化 | 建立产品货架、技术货架、知识库三大资产中心 |
| 协作高效化 | 集成项目管理、即时通信、技术论坛，提升协作效率 |
| 决策数据化 | 通过仪表盘、报表提供多维度决策支持 |

### 1.3 核心用户角色

```
┌─────────────────────────────────────────────────────────────┐
│                        部门领导                              │
│                    (战略决策/资源调配)                        │
└───────────────────────┬─────────────────────────────────────┘
                        │
        ┌───────────────┼───────────────┐
        │               │               │
┌───────▼──────┐ ┌──────▼──────┐ ┌──────▼──────┐
│  产品管理团队  │ │ 产品开发团队  │ │ 技术开发团队  │
│ ·型号管理    │ │ ·A产品线    │ │ ·天线设计   │
│ ·可靠性管理  │ │ ·B产品线    │ │ ·射频设计   │
│ ·需求对接    │ │ ·C产品线    │ │ ·数字设计   │
└──────────────┘ └─────────────┘ └─────────────┘
                        │
               ┌────────▼────────┐
               │   综合管理虚拟团队  │
               │ (安全/保密/档案/   │
               │  宣传/6S/党建)     │
               └─────────────────┘
```

---

## 2. 系统架构设计

### 2.1 整体架构

```mermaid
graph TB
    subgraph "客户端层"
        A[Web浏览器]
        B[桌面客户端]
        C[移动端]
    end
    
    subgraph "网关层"
        D[Nginx反向代理]
        E[API Gateway]
        F[负载均衡]
    end
    
    subgraph "前端层"
        G[门户界面 Portal]
        H[项目管理 PM]
        I[项目开发 PD]
        J[货架管理 Shelf]
        K[知识库 Wiki]
        L[技术论坛 Forum]
        M[即时通信 IM]
        N[用户中心 UC]
    end
    
    subgraph "后端服务层"
        O[用户服务 User Service]
        P[项目服务 Project Service]
        Q[工作流引擎 Workflow Engine]
        R[文件服务 File Service]
        S[通知服务 Notification]
        T[搜索服务 Search Service]
        U[消息服务 Message Service]
    end
    
    subgraph "数据层"
        V[(PostgreSQL)]
        W[(Redis)]
        X[(Elasticsearch)]
        Y[(MinIO/文件系统)]
        Z[(MongoDB)]
    end
    
    subgraph "集成层"
        AA[Git集成]
        AB[Obsidian集成]
        AC[Zotero集成]
        AD[外部系统]
    end
    
    A --> D
    B --> D
    C --> D
    D --> E
    E --> F
    F --> G
    F --> H
    F --> I
    F --> J
    F --> K
    F --> L
    F --> M
    F --> N
    
    G --> O
    H --> P
    I --> Q
    I --> R
    J --> P
    K --> T
    L --> U
    M --> U
    N --> O
    
    O --> V
    P --> V
    Q --> V
    R --> Y
    S --> W
    T --> X
    U --> W
    
    R --> AA
    K --> AB
    K --> AC
    P --> AD
```

### 2.2 微服务架构

```mermaid
graph LR
    subgraph "基础设施"
        INF1[服务注册发现 Consul/Nacos]
        INF2[配置中心 Nacos/Apollo]
        INF3[监控告警 Prometheus+Grafana]
        INF4[链路追踪 Jaeger]
        INF5[日志收集 ELK]
    end
    
    subgraph "核心服务"
        S1[用户服务<br/>user-service]
        S2[项目服务<br/>project-service]
        S3[工作流服务<br/>workflow-service]
        S4[文件服务<br/>file-service]
        S5[知识库服务<br/>wiki-service]
        S6[消息服务<br/>message-service]
        S7[搜索服务<br/>search-service]
        S8[货架服务<br/>shelf-service]
    end
    
    subgraph "公共服务"
        C1[认证中心<br/>OAuth2/JWT]
        C2[权限服务<br/>RBAC]
        C3[通知服务<br/>Email/WebSocket]
        C4[网关服务<br/>Spring Gateway]
    end
    
    INF1 --> S1
    INF1 --> S2
    INF1 --> S3
    INF1 --> S4
    INF1 --> S5
    INF1 --> S6
    INF1 --> S7
    INF1 --> S8
    
    C4 --> S1
    C4 --> S2
    C4 --> S3
    C4 --> S4
    C4 --> S5
    C4 --> S6
    C4 --> S7
    C4 --> S8
```

### 2.3 模块依赖关系图

```mermaid
graph TD
    subgraph "核心依赖"
        A[用户管理模块] 
    end
    
    subgraph "业务模块"
        B[门户界面]
        C[项目管理模块]
        D[项目开发模块]
        E[产品货架模块]
        F[技术货架模块]
        G[知识库模块]
        H[技术论坛模块]
        I[即时通信模块]
    end
    
    subgraph "基础服务"
        J[工作流引擎]
        K[文件服务]
        L[搜索服务]
        M[消息服务]
    end
    
    A --> B
    A --> C
    A --> D
    A --> H
    A --> I
    
    C --> D
    C --> J
    
    D --> J
    D --> K
    D --> L
    D --> M
    
    E --> C
    E --> K
    E --> L
    
    F --> C
    F --> K
    F --> L
    
    G --> K
    G --> L
    G --> M
    
    H --> A
    H --> M
    
    I --> A
    I --> M
    
    J --> K
    J --> M
```

---

## 3. 技术选型与开源组件

### 3.1 技术栈总览

| 层次 | 技术选型 | 版本建议 | 选型理由 |
|------|---------|---------|---------|
| **前端框架** | Vue3 + TypeScript | 3.4+ | 响应式系统、组合式API、类型安全 |
| **UI组件库** | Element Plus + Ant Design Vue | 2.x | 丰富的企业级组件、良好的生态 |
| **状态管理** | Pinia | 2.x | Vue3官方推荐、TypeScript友好 |
| **后端框架** | Spring Boot | 3.2+ | 成熟稳定、生态丰富、微服务支持 |
| **微服务框架** | Spring Cloud Alibaba | 2022+ | 完善的微服务解决方案 |
| **数据库** | PostgreSQL | 16+ | 强大的JSON支持、扩展性好 |
| **缓存** | Redis | 7+ | 高性能、支持多种数据结构 |
| **搜索引擎** | Elasticsearch | 8+ | 全文搜索、聚合分析 |
| **消息队列** | RabbitMQ | 3.12+ | 可靠的消息传递、工作流支持 |
| **文件存储** | MinIO | latest | 兼容S3、高性能对象存储 |
| **容器化** | Docker + Kubernetes | - | 标准化部署、弹性伸缩 |

### 3.2 各模块开源组件选型

#### 3.2.1 门户界面

| 功能 | 开源组件 | 说明 |
|------|---------|------|
| 仪表盘模板 | **black-dashboard-react** | React管理仪表盘，美观现代 |
| 工作台布局 | **vue-grid-layout** | 可拖拽的网格布局系统 |
| 图表组件 | **ECharts** / **AntV G2** | 数据可视化 |
| 日历组件 | **FullCalendar** | 日程管理展示 |

**推荐方案**：基于Vue3 + Element Plus自研，参考black-dashboard-react的设计风格

#### 3.2.2 用户管理模块

| 功能 | 开源组件 | 说明 |
|------|---------|------|
| 组织架构 | **自研** | 树形结构展示部门、团队、岗位 |
| 权限控制 | **Spring Security + JWT** | 认证授权 |
| RBAC模型 | **自研** | 角色-权限-资源模型 |
| 个人页面 | 参考GitHub Profile | 展示项目、贡献、能力图 |

**推荐方案**：基于Spring Security自研，组织架构和权限模型根据需求定制

#### 3.2.3 项目管理模块

| 功能 | 开源组件 | 说明 |
|------|---------|------|
| 甘特图 | **dhtmlx-gantt** / **gantt-elastic** | 项目进度可视化 |
| 看板 | **Vue.Draggable** + 自研 | 拖拽式任务看板 |
| 项目模板 | **Plane** (参考) | 轻量级项目管理理念 |
| 自动排程 | **自研** | 基于CPM算法实现 |

**推荐方案**：
- 甘特图：使用dhtmlx-gantt（功能完整）
- 项目管理核心：参考Plane架构自研
- 自动排程：基于CPM算法自研排程引擎

#### 3.2.4 项目开发模块（工作流引擎）

| 功能 | 开源组件 | 说明 |
|------|---------|------|
| 流程设计器 | **bpmn-js** | BPMN 2.0可视化设计器 |
| 流程引擎 | **bpmn-engine** (paed01) | BPMN 2.0执行引擎 |
| 流程模型 | **camunda-bpmn-moddle** | BPMN模型解析 |
| Git集成 | **JGit** (Java) / **isomorphic-git** (JS) | Git操作库 |

**推荐方案**：
- 流程设计器：**bpmn-js**（业界标准）
- 流程引擎：**bpmn-engine**（Node.js，轻量）或自研Java版本
- Git集成：**JGit** + 本地Git仓库

#### 3.2.5 产品/技术货架模块

| 功能 | 开源组件 | 说明 |
|------|---------|------|
| 产品目录 | **自研** | 分类浏览、筛选 |
| 版本管理 | **Git LFS** | 大文件版本控制 |
| 文件预览 | **kkFileView** | 多格式文件在线预览 |

**推荐方案**：自研核心功能，集成kkFileView实现文件预览

#### 3.2.6 知识库模块

| 功能 | 开源组件 | 说明 |
|------|---------|------|
| Wiki引擎 | **Wiki.js** (参考) | 现代Wiki系统设计理念 |
| Markdown编辑器 | **Vditor** / **Milkdown** | 所见即所得编辑器 |
| 全文搜索 | **Elasticsearch** | 高性能搜索 |
| Obsidian集成 | **自研** + Obsidian API | 双向同步 |
| Zotero集成 | **Zotero API** | 文献管理集成 |

**推荐方案**：
- 核心Wiki：参考Wiki.js架构自研
- Markdown编辑器：**Vditor**（功能完善、中文友好）
- 与Obsidian集成：通过本地文件系统 + Git实现

#### 3.2.7 技术论坛模块

| 功能 | 开源组件 | 说明 |
|------|---------|------|
| 论坛系统 | **Flarum** (参考) | 现代论坛设计理念 |
| 富文本编辑 | **Quill.js** / **TipTap** | 内容编辑器 |
| 实时通知 | **WebSocket** | 消息推送 |

**推荐方案**：自研轻量级论坛，参考Flarum的交互设计

#### 3.2.8 即时通信模块

| 功能 | 开源组件 | 说明 |
|------|---------|------|
| IM核心 | **Mattermost** | 开源Slack替代品 |
| WebSocket | **Socket.IO** | 实时通信 |
| 消息存储 | **MongoDB** | 消息持久化 |

**推荐方案**：
- **推荐**：集成Mattermost作为IM后端，自研前端界面
- **备选**：基于Socket.IO自研轻量级IM

---

## 4. 模块设计方案

### 4.1 门户界面模块

#### 功能设计

```mermaid
graph TD
    A[门户首页] --> B[工作台]
    A --> C[个人仪表盘]
    A --> D[部门公告]
    A --> E[快捷入口]
    
    B --> B1[我的项目]
    B --> B2[待办任务]
    B --> B3[最近访问]
    B --> B4[常用工具]
    
    C --> C1[项目进度概览]
    C --> C2[工时统计]
    C --> C3[绩效指标]
    
    E --> E1[项目管理]
    E --> E2[产品货架]
    E --> E3[技术货架]
    E --> E4[知识库]
    E --> E5[技术论坛]
    E --> E6[即时通信]
```

#### 技术实现

- **前端**：Vue3 + Element Plus + vue-grid-layout
- **组件化设计**：每个功能区块作为独立组件，支持拖拽布局
- **数据聚合**：通过BFF层聚合各模块数据

### 4.2 用户管理模块

#### 数据模型

```mermaid
erDiagram
    USER ||--o{ USER_ROLE : has
    USER ||--o{ USER_TEAM : belongs
    ROLE ||--o{ USER_ROLE : assigned
    TEAM ||--o{ USER_TEAM : contains
    ROLE ||--o{ ROLE_PERMISSION : has
    PERMISSION ||--o{ ROLE_PERMISSION : granted
    
    USER {
        bigint id PK
        string username
        string email
        string phone
        string password_hash
        string real_name
        string avatar
        enum title "职称"
        timestamp created_at
        timestamp updated_at
        boolean is_active
    }
    
    TEAM {
        bigint id PK
        string name
        string code
        bigint parent_id FK
        enum team_type "PRODUCT_MGMT/PRODUCT_DEV/TECH_DEV/GENERAL"
        string description
    }
    
    ROLE {
        bigint id PK
        string name
        string code
        enum role_type "ADMIN/DEPT_LEAD/TEAM_LEAD/DESIGNER/OTHER"
        string description
    }
    
    PERMISSION {
        bigint id PK
        string name
        string code
        string resource
        string action
    }
    
    USER_PROFILE {
        bigint user_id PK
        text honors
        text skills
        json ability_chart
        json project_history
        timestamp last_active
    }
```

#### 功能清单

| 功能 | 说明 |
|------|------|
| 用户CRUD | 创建、编辑、禁用、删除用户 |
| 组织架构 | 树形展示部门-团队-岗位 |
| 角色管理 | 管理员、部门领导、团队组长、设计师、其他 |
| 职称体系 | 设计员、助理工程师、工程师、高级工程师、研究员 |
| 个人页面 | GitHub风格个人主页 |
| 能力图 | 雷达图展示技能分布 |
| 项目履历 | 历史项目参与记录 |

### 4.3 项目管理模块

#### 项目创建流程

```mermaid
sequenceDiagram
    actor U as 用户
    participant P as 门户界面
    participant PS as 项目服务
    participant WS as 工作流服务
    participant FS as 文件服务
    participant DB as 数据库
    
    U->>P: 点击创建项目
    P->>PS: 请求项目模板列表
    PS-->>P: 返回模板列表
    
    U->>P: 步骤1：填写基础信息
    P->>PS: 校验项目名称
    PS-->>P: 校验结果
    
    U->>P: 步骤2：选择项目类别
    P->>PS: 获取类别对应流程
    PS-->>P: 返回推荐流程模板
    
    U->>P: 步骤3：确认/选择流程模板
    P->>WS: 预览流程图
    WS-->>P: 返回流程定义
    
    U->>P: 步骤4：分配团队成员
    P->>PS: 获取组织架构人员
    PS-->>P: 返回人员列表
    
    U->>P: 步骤5：确认创建
    P->>PS: 提交创建请求
    PS->>PS: 自动生成项目代号
    PS->>WS: 初始化流程实例
    WS-->>PS: 返回流程实例ID
    PS->>PS: 执行自动排程
    PS->>FS: 创建项目文件夹
    FS-->>PS: 返回文件夹路径
    PS->>DB: 保存项目数据
    PS->>PS: 发送创建通知
    PS-->>P: 返回创建结果
    P-->>U: 显示项目详情页
```

#### 自动排程算法

```mermaid
flowchart TD
    A[开始排程] --> B[加载活动列表]
    B --> C[解析依赖关系]
    C --> D[计算正向遍历<br/>最早开始/结束时间]
    D --> E[计算反向遍历<br/>最晚开始/结束时间]
    E --> F[计算浮动时间]
    F --> G[识别关键路径<br/>浮动时间为0的活动]
    G --> H[检查资源冲突]
    H --> I{存在冲突?}
    I -->|是| J[应用冲突解决策略]
    J --> H
    I -->|否| K[生成甘特图数据]
    K --> L[结束]
```

#### 核心功能

| 功能 | 技术方案 |
|------|---------|
| 项目模板 | 预定义模板 + 自定义模板 |
| 自动排程 | CPM关键路径法 + 资源约束 |
| 甘特图 | dhtmlx-gantt组件 |
| 仪表盘 | ECharts数据可视化 |
| MS Project导入导出 | mpxj库解析.mpp文件 |

### 4.4 项目开发模块

#### 活动执行流程

```mermaid
sequenceDiagram
    actor U as 设计师
    participant PD as 项目开发界面
    participant WS as 工作流引擎
    participant FS as 文件服务
    participant Git as Git仓库
    participant DB as 数据库
    
    U->>PD: 进入项目开发界面
    PD->>WS: 获取流程状态
    WS-->>PD: 返回当前活动
    
    U->>PD: 点击当前活动
    PD->>WS: 获取活动详情
    WS-->>PD: 返回输入/输出/模板
    
    U->>PD: 下载项目文件夹
    PD->>FS: 请求打包下载
    FS-->>PD: 返回下载链接
    
    U->>PD: 点击模板文件
    PD->>FS: 获取文件内容
    FS->>Git: 读取文件
    Git-->>FS: 返回文件
    FS-->>PD: 返回文件数据
    PD->>PD: 调用本地软件打开
    
    U->>PD: 编辑完成，点击提交
    PD->>FS: 上传文件
    FS->>Git: 提交变更
    Git-->>FS: 返回commit信息
    FS->>DB: 记录文件版本
    FS-->>PD: 提交成功
    
    U->>PD: 点击完成活动
    PD->>WS: 请求完成活动
    WS->>WS: 校验完成条件
    WS->>DB: 更新活动状态
    WS->>WS: 触发下一活动
    WS->>PS: 更新项目进度
    WS-->>PD: 返回下一活动
    PD-->>U: 显示更新后流程
```

#### 本地软件集成方案

```mermaid
graph LR
    subgraph "Web端"
        A[项目开发界面]
        B[文件操作按钮]
        C[自定义协议调用]
    end
    
    subgraph "本地环境"
        D[协议处理器]
        E[本地代理服务]
    end
    
    subgraph "本地软件"
        F[Obsidian]
        G[Altium Designer]
        H[Office]
        I[其他软件]
    end
    
    A --> B
    B --> C
    C -->|rdp://| D
    D --> E
    E --> F
    E --> G
    E --> H
    E --> I
```

**自定义协议设计**：
- `rdp://open?path=/project/file.md&app=obsidian`
- `rdp://open?path=/project/pcb.schdoc&app=altium`

### 4.5 产品货架模块

#### 功能架构

```mermaid
graph TD
    A[产品货架首页] --> B[分类导航]
    A --> C[搜索筛选]
    A --> D[推荐产品]
    
    B --> B1[单机]
    B --> B2[模块]
    B --> B3[软件]
    B --> B4[基础件]
    
    B4 --> B4a[元器件]
    B4 --> B4b[标准件]
    B4 --> B4c[原材料]
    
    C --> C1[按类型]
    C --> C2[按规格]
    C --> C3[按成熟度]
    C --> C4[按授权]
    
    E[产品详情页] --> E1[产品介绍]
    E --> E2[图片展示]
    E --> E3[测试数据]
    E --> E4[应用履历]
    E --> E5[问题记录]
    E --> E6[项目文件]
    E --> E7[负责人信息]
    
    E --> F[操作按钮]
    F --> F1[加入选用单]
    F --> F2[相似创建]
    F --> F3[迭代开发]
```

### 4.6 技术货架模块

#### 技术树展示

```mermaid
graph TD
    A[技术货架] --> B[设计技术]
    A --> C[试验技术]
    A --> D[仿真技术]
    
    B --> B1[集成技术]
    B --> B2[天线技术]
    B --> B3[射频技术]
    B --> B4[数字技术]
    B --> B5[电源技术]
    B --> B6[软件技术]
    
    B3 --> B3a[接收通道]
    B3 --> B3b[功放]
    B3 --> B3c[频率源]
    B3 --> B3d[变频模块]
    
    B4 --> B4a[数字电路]
    B4 --> B4b[FPGA+ADC]
    B4 --> B4c[RFSoC]
    
    C --> C1[环境试验]
    C --> C2[EMC试验]
    C --> C3[可靠性试验]
    
    D --> D1[ANSYS热分析]
    D --> D2[ANSYS力分析]
    D --> D3[CST电磁场]
    D --> D4[EMI/EMC仿真]
```

### 4.7 知识库模块

#### 知识分类体系

```mermaid
graph TD
    A[知识库] --> B[理论知识]
    A --> C[标准规范]
    A --> D[制度文件]
    A --> E[流程说明]
    A --> F[案例库]
    A --> G[仿真模型]
    A --> H[软件指南]
    
    B --> B1[电子书]
    B --> B2[论文专利]
    B --> B3[专业知识]
    
    B1 --> B1a[数学]
    B1 --> B1b[物理]
    B1 --> B1c[电磁场]
    B1 --> B1d[电路]
    B1 --> B1e[嵌入式]
    
    C --> C1[国标]
    C --> C2[国军标]
    C --> C3[航天标准]
    C --> C4[行业标准]
    C --> C5[部门标准]
    
    F --> F1[正面案例]
    F --> F2[反面案例]
    F --> F3[质量归零]
```

#### Obsidian集成方案

```mermaid
sequenceDiagram
    participant Web as 知识库Web端
    participant API as 后端API
    participant Git as Git仓库
    participant Obs as Obsidian本地
    participant User as 用户
    
    User->>Obs: 本地编辑笔记
    Obs->>Git: 自动提交变更
    Git->>API: Webhook触发同步
    API->>API: 解析Markdown
    API->>Web: 更新Web端内容
    
    User->>Web: Web端编辑
    Web->>API: 保存内容
    API->>Git: 提交到仓库
    Git->>Obs: 拉取更新
    Obs->>User: 本地同步完成
```

### 4.8 技术论坛模块

#### 功能设计

- 板块管理：按技术领域划分板块
- 帖子管理：发帖、回复、点赞、收藏
- 富文本编辑：支持Markdown、代码高亮
- 通知系统：@提及、回复通知
- 搜索功能：全文检索帖子内容

### 4.9 即时通信模块

#### 架构设计

```mermaid
graph TD
    subgraph "客户端"
        A[Web客户端]
        B[桌面客户端]
        C[移动客户端]
    end
    
    subgraph "服务端"
        D[WebSocket网关]
        E[消息服务]
        F[用户状态服务]
        G[文件传输服务]
    end
    
    subgraph "存储层"
        H[(消息存储<br/>MongoDB)]
        I[(会话存储<br/>Redis)]
        J[(文件存储<br/>MinIO)]
    end
    
    A --> D
    B --> D
    C --> D
    D --> E
    D --> F
    E --> G
    E --> H
    F --> I
    G --> J
```

---

## 5. 数据架构

### 5.1 数据库设计

#### 5.1.1 PostgreSQL核心库

```mermaid
erDiagram
    USER ||--o{ PROJECT_MEMBER : participates
    USER ||--o{ PROJECT : leads
    PROJECT ||--o{ PROJECT_MEMBER : has
    PROJECT ||--o{ ACTIVITY : contains
    PROJECT ||--|| WORKFLOW_INSTANCE : uses
    WORKFLOW_DEFINITION ||--o{ WORKFLOW_INSTANCE : instantiated
    
    USER {
        bigint id PK
        string username UK
        string email UK
        string real_name
        enum title
        json profile
        timestamp created_at
    }
    
    PROJECT {
        bigint id PK
        string name
        string code UK
        enum category
        bigint workflow_def_id FK
        json workflow_config
        timestamp start_date
        timestamp end_date
        enum status
        bigint creator_id FK
    }
    
    WORKFLOW_DEFINITION {
        bigint id PK
        string name
        string code UK
        json bpmn_definition
        enum category
        boolean is_template
    }
    
    WORKFLOW_INSTANCE {
        bigint id PK
        bigint project_id FK
        bigint workflow_def_id FK
        json variables
        enum status
        timestamp started_at
        timestamp completed_at
    }
    
    ACTIVITY {
        bigint id PK
        bigint project_id FK
        string activity_key
        string name
        json input_deliverables
        json output_deliverables
        enum status
        timestamp planned_start
        timestamp planned_end
        timestamp actual_start
        timestamp actual_end
    }
    
    PRODUCT_SHELF {
        bigint id PK
        string name
        string code UK
        enum category
        json specifications
        json test_data
        json application_history
        bigint responsible_id FK
        enum maturity_level
    }
```

#### 5.1.2 MongoDB消息库

```javascript
// 消息集合
{
  _id: ObjectId,
  conversation_id: String,  // 会话ID
  sender_id: Number,        // 发送者ID
  message_type: String,     // text/file/image/system
  content: String,          // 消息内容
  file_info: {              // 文件信息（可选）
    file_id: String,
    file_name: String,
    file_size: Number
  },
  mentions: [Number],       // @的用户ID列表
  created_at: Date,
  updated_at: Date,
  is_deleted: Boolean
}

// 会话集合
{
  _id: ObjectId,
  conversation_type: String, // private/group
  participants: [Number],    // 参与者ID列表
  last_message: Object,      // 最后一条消息
  unread_count: Map,         // 用户未读数
  created_at: Date
}
```

### 5.2 数据流图

```mermaid
graph LR
    subgraph "数据源"
        A[用户操作]
        B[系统事件]
        C[外部集成]
    end
    
    subgraph "数据采集"
        D[API网关]
        E[消息队列]
    end
    
    subgraph "数据处理"
        F[业务服务]
        G[工作流引擎]
        H[文件服务]
    end
    
    subgraph "数据存储"
        I[(PostgreSQL<br/>业务数据)]
        J[(Redis<br/>缓存/会话)]
        K[(MongoDB<br/>消息)]
        L[(Elasticsearch<br/>搜索索引)]
        M[(MinIO<br/>文件)]
        N[(Git<br/>版本)]
    end
    
    A --> D
    B --> D
    C --> D
    D --> E
    E --> F
    E --> G
    E --> H
    F --> I
    F --> J
    F --> L
    G --> I
    H --> M
    H --> N
    F --> K
```

### 5.3 数据同步策略

| 场景 | 同步方式 | 说明 |
|------|---------|------|
| 用户信息 | 实时同步 | 用户变更立即同步 |
| 项目数据 | 准实时 | 5秒延迟，批量写入 |
| 消息数据 | 实时 | WebSocket推送 |
| 搜索索引 | 异步 | 消息队列异步更新 |
| 文件数据 | 异步 | 后台同步到Git |

---

## 6. 集成方案

### 6.1 Git集成

```mermaid
sequenceDiagram
    participant Web as Web端
    participant API as 文件服务API
    participant Git as Git仓库
    participant Local as 本地环境
    
    Web->>API: 请求项目文件列表
    API->>Git: 执行git ls-tree
    Git-->>API: 返回文件树
    API-->>Web: 返回文件列表
    
    Web->>API: 下载项目文件夹
    API->>Git: 执行git archive
    Git-->>API: 返回zip包
    API-->>Web: 返回下载链接
    
    Local->>API: 上传编辑后的文件
    API->>Git: 执行git add + commit
    Git-->>API: 返回commit hash
    API->>API: 记录版本信息
    API-->>Local: 上传成功
```

### 6.2 Obsidian集成

**方案**：通过Git仓库双向同步

```
局域网服务器                    本地工作站
┌─────────────┐              ┌─────────────┐
│ 研发平台     │              │  Obsidian   │
│  知识库     │◄────────────►│  本地库     │
│  Git仓库    │   Git同步     │  Git仓库    │
└─────────────┘              └─────────────┘
```

### 6.3 Zotero集成

```mermaid
sequenceDiagram
    participant Web as 知识库Web
    participant API as 后端API
    participant Zotero as Zotero API
    
    Web->>API: 请求Zotero文献列表
    API->>Zotero: GET /users/{userID}/items
    Zotero-->>API: 返回文献数据
    API-->>Web: 返回格式化数据
    
    Web->>API: 引用文献到知识库
    API->>API: 创建文献条目
    API->>API: 关联到知识库文章
    API-->>Web: 引用成功
```

### 6.4 外部系统集成

| 系统 | 集成方式 | 功能 |
|------|---------|------|
| ERP | REST API | 同步BOM、物料信息 |
| MES | REST API | 同步生产任务、工艺文件 |
| LDAP/AD | LDAP协议 | 统一身份认证 |
| 邮件系统 | SMTP/IMAP | 邮件通知 |

---

## 7. 实施计划

### 7.1 阶段划分

```mermaid
gantt
    title 研发平台实施计划
    dateFormat  YYYY-MM-DD
    section 第一阶段
    基础架构搭建           :a1, 2026-03-01, 14d
    用户管理模块           :a2, after a1, 14d
    门户界面               :a3, after a2, 10d
    项目管理模块(基础)      :a4, after a3, 21d
    
    section 第二阶段
    工作流引擎             :b1, after a4, 21d
    项目开发模块           :b2, after b1, 21d
    文件服务               :b3, after b2, 14d
    Git集成                :b4, after b3, 10d
    
    section 第三阶段
    产品货架模块           :c1, after b4, 14d
    技术货架模块           :c2, after c1, 14d
    知识库模块             :c3, after c2, 21d
    搜索服务               :c4, after c3, 10d
    
    section 第四阶段
    技术论坛模块           :d1, after c4, 14d
    即时通信模块           :d2, after d1, 21d
    系统集成测试           :d3, after d2, 14d
    用户培训与上线          :d4, after d3, 14d
```

### 7.2 第一阶段：基础平台（6周）

**目标**：搭建基础架构，实现用户管理和项目基础功能

| 周次 | 任务 | 交付物 |
|------|------|--------|
| 1-2 | 基础架构搭建 | 开发环境、CI/CD、基础服务 |
| 3-4 | 用户管理模块 | 用户CRUD、组织架构、权限体系 |
| 5 | 门户界面 | 工作台、仪表盘、快捷入口 |
| 6-8 | 项目管理模块(基础) | 项目创建、基础甘特图、项目列表 |

**技术重点**：
- 微服务基础框架搭建
- 统一认证授权体系
- 前端基础组件库

### 7.3 第二阶段：核心开发（8周）

**目标**：实现工作流引擎和项目开发核心功能

| 周次 | 任务 | 交付物 |
|------|------|--------|
| 9-11 | 工作流引擎 | BPMN设计器、流程引擎、流程模板 |
| 12-14 | 项目开发模块 | 活动执行、进度追踪、任务管理 |
| 15-16 | 文件服务 | 文件上传下载、版本管理 |
| 17 | Git集成 | 本地Git仓库、版本控制 |

**技术重点**：
- bpmn-js流程设计器集成
- 工作流引擎状态机实现
- Git操作封装

### 7.4 第三阶段：资产管理（7周）

**目标**：实现产品货架、技术货架、知识库

| 周次 | 任务 | 交付物 |
|------|------|--------|
| 18-19 | 产品货架模块 | 产品展示、分类浏览、选用功能 |
| 20-21 | 技术货架模块 | 技术树、技术详情、版本管理 |
| 22-24 | 知识库模块 | Wiki编辑、分类管理、Obsidian集成 |
| 25 | 搜索服务 | 全文搜索、智能推荐 |

**技术重点**：
- Elasticsearch搜索索引构建
- Vditor编辑器集成
- 与Obsidian的双向同步

### 7.5 第四阶段：协作功能（7周）

**目标**：实现技术论坛、即时通信，完成系统测试和上线

| 周次 | 任务 | 交付物 |
|------|------|--------|
| 26-27 | 技术论坛模块 | 板块管理、发帖回帖、富文本编辑 |
| 28-30 | 即时通信模块 | 私聊、群聊、文件传输 |
| 31-32 | 系统集成测试 | 测试报告、Bug修复 |
| 33-34 | 用户培训与上线 | 操作手册、培训、正式上线 |

**技术重点**：
- Mattermost集成或自研IM
- WebSocket实时通信
- 系统性能优化

### 7.6 里程碑

| 里程碑 | 时间 | 标志 |
|--------|------|------|
| M1 | 第6周末 | 基础平台可用，可创建和管理用户、项目 |
| M2 | 第14周末 | 核心开发功能可用，可执行项目开发流程 |
| M3 | 第21周末 | 资产管理功能可用，产品/技术/知识可沉淀 |
| M4 | 第28周末 | 协作功能可用，团队可在线协作 |
| M5 | 第34周末 | 系统正式上线运行 |

---

## 8. 风险与应对

### 8.1 技术风险

| 风险 | 影响 | 应对措施 |
|------|------|---------|
| 工作流引擎复杂度高 | 开发延期 | 采用成熟开源组件bpmn-js，降低自研风险 |
| Git集成实现困难 | 文件版本管理受阻 | 预留2周技术预研，准备备选方案 |
| 局域网部署限制 | 部分功能受限 | 提前调研离线可用方案，如Mattermost本地部署 |
| 性能瓶颈 | 用户体验差 | 提前规划缓存策略、数据库优化 |

### 8.2 管理风险

| 风险 | 影响 | 应对措施 |
|------|------|---------|
| 需求变更频繁 | 开发返工 | 建立需求变更流程，每个阶段冻结需求 |
| 多团队协作困难 | 进度不一致 | 每周同步会议，统一接口规范 |
| 用户接受度低 | 推广困难 | 早期引入用户参与，迭代优化 |

### 8.3 风险矩阵

```
影响程度
   高 │  ③需求变更    ④性能瓶颈
      │  ①工作流复杂
   中 │              ②Git集成
      │
   低 │
      └─────────────────────────
        低          中          高
                  发生概率

① 重点关注：技术预研 + 成熟组件
② 提前准备：技术预研2周 + 备选方案
③ 流程管控：变更控制委员会
④ 架构设计：性能测试 + 优化方案
```

---

## 9. 资源估算

### 9.1 人力资源

| 角色 | 人数 | 职责 |
|------|------|------|
| 项目经理 | 1 | 项目管理、进度把控、风险管控 |
| 架构师 | 1 | 技术架构设计、技术选型、代码审查 |
| 前端开发工程师 | 3 | 前端模块开发、UI实现 |
| 后端开发工程师 | 4 | 后端服务开发、数据库设计 |
| DevOps工程师 | 1 | CI/CD、部署运维、监控 |
| 测试工程师 | 2 | 功能测试、性能测试、自动化测试 |
| UI设计师 | 1 | 界面设计、交互设计 |
| **合计** | **13** | |

### 9.2 硬件资源

| 环境 | 配置 | 数量 | 用途 |
|------|------|------|------|
| 生产服务器 | 32核64G | 3 | 应用服务集群 |
| 数据库服务器 | 16核32G | 2 | PostgreSQL主从 |
| 文件服务器 | 16核32G/10T | 1 | MinIO文件存储 |
| 开发服务器 | 8核16G | 2 | 开发测试环境 |
| **合计** | | **8** | |

### 9.3 软件资源

| 软件 | 许可 | 用途 |
|------|------|------|
| 操作系统 | CentOS/Ubuntu (开源) | 服务器操作系统 |
| 数据库 | PostgreSQL (开源) | 关系型数据库 |
| 缓存 | Redis (开源) | 缓存与会话 |
| 搜索 | Elasticsearch (开源) | 全文搜索引擎 |
| 消息队列 | RabbitMQ (开源) | 异步消息处理 |
| 文件存储 | MinIO (开源) | 对象存储 |
| 监控 | Prometheus+Grafana (开源) | 系统监控 |
| **软件成本** | **0元** | 全部开源 |

### 9.4 时间估算

| 阶段 | 周期 | 工作量（人月） |
|------|------|---------------|
| 第一阶段 | 6周 | 18人月 |
| 第二阶段 | 8周 | 24人月 |
| 第三阶段 | 7周 | 21人月 |
| 第四阶段 | 7周 | 21人月 |
| **总计** | **28周（7个月）** | **84人月** |

### 9.5 成本估算

| 成本项 | 金额（万元） |
|--------|-------------|
| 人力成本（84人月×1.5万/人月） | 126 |
| 硬件采购 | 30 |
| 网络与基础设施 | 10 |
| 培训与差旅 | 5 |
| 不可预见费用（10%） | 17 |
| **总计** | **188** |

---

## 附录

### 附录A：技术选型对比表

| 功能 | 方案A | 方案B | 推荐 |
|------|-------|-------|------|
| 前端框架 | Vue3 | React | Vue3（团队熟悉） |
| 后端框架 | Spring Boot | Django | Spring Boot（生态丰富） |
| 流程引擎 | bpmn-engine | 自研 | bpmn-engine（成熟） |
| IM方案 | Mattermost集成 | 自研 | Mattermost（功能完整） |
| 编辑器 | Vditor | Milkdown | Vditor（中文友好） |

### 附录B：开源组件清单

| 组件名称 | 许可证 | 用途 |
|---------|--------|------|
| Vue3 | MIT | 前端框架 |
| Element Plus | MIT | UI组件库 |
| Spring Boot | Apache 2.0 | 后端框架 |
| PostgreSQL | PostgreSQL | 数据库 |
| Redis | BSD | 缓存 |
| Elasticsearch | SSPL | 搜索引擎 |
| bpmn-js | MIT | 流程设计器 |
| bpmn-engine | MIT | 流程引擎 |
| Vditor | MIT | Markdown编辑器 |
| Mattermost | MIT | 即时通信 |
| MinIO | AGPL | 对象存储 |

### 附录C：部署架构图

```mermaid
graph TB
    subgraph "外部访问"
        A[用户浏览器]
    end
    
    subgraph "DMZ区"
        B[Nginx负载均衡]
    end
    
    subgraph "应用服务区"
        C1[应用服务器1<br/>前端+API网关]
        C2[应用服务器2<br/>微服务集群]
        C3[应用服务器3<br/>微服务集群]
    end
    
    subgraph "数据服务区"
        D1[PostgreSQL主库]
        D2[PostgreSQL从库]
        D3[Redis集群]
        D4[Elasticsearch集群]
        D5[MinIO对象存储]
        D6[Git仓库服务器]
    end
    
    subgraph "消息服务区"
        E1[RabbitMQ主节点]
        E2[RabbitMQ从节点]
    end
    
    A --> B
    B --> C1
    C1 --> C2
    C1 --> C3
    C2 --> D1
    C2 --> D3
    C2 --> D4
    C2 --> D5
    C2 --> D6
    C2 --> E1
    C3 --> D2
    C3 --> D3
    C3 --> D4
    C3 --> D5
    C3 --> D6
    C3 --> E2
    D1 --> D2
    E1 --> E2
```

---

**文档版本**：v1.0  
**编制日期**：2026年2月  
**编制人**：解决方案架构师
